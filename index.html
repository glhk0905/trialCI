<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¯”è³½ç°½åˆ°ç³»çµ±</title>

<style>
body{font-family:Arial;background:#000;color:#fff;margin:0;text-align:center}
header{background:#111;padding:18px;font-size:26px;font-weight:bold}
input,button{width:92%;max-width:420px;padding:18px;margin:12px auto;
font-size:24px;border-radius:12px;border:none}
.event-btn{background:#1E88E5;color:#fff}
.first-btn{background:#43A047;color:#fff}
.back-btn{background:#555;color:#fff}
.manual-btn{background:#F9A825;color:#000}
.confirm{color:#4CAF50;font-size:36px}
.hidden{display:none}
.small{font-size:16px;opacity:.6}
</style>
</head>

<body>

<header id="header">ğŸ” å·¥ä½œäººå“¡ç™»å…¥</header>

<!-- å·¥ä½œäººå“¡ -->
<div id="staffPage">
  <input id="staffInput" placeholder="è¼¸å…¥å·¥ä½œäººå“¡åç¨±">
  <button class="event-btn" onclick="saveStaff()">é–‹å§‹</button>
</div>

<!-- é …ç›® -->
<div id="eventPage" class="hidden">
  <button class="first-btn" onclick="selectEvent('é¦–æ¬¡å ±åˆ°')">â‘  é¦–æ¬¡å ±åˆ°</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®ä¸€')">â‘¡ é …ç›®ä¸€</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®äºŒ')">â‘¢ é …ç›®äºŒ</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®ä¸‰')">â‘£ é …ç›®ä¸‰</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®å››')">â‘¤ é …ç›®å››</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®äº”')">â‘¥ é …ç›®äº”</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®å…­')">â‘¦ é …ç›®å…­</button>
</div>

<!-- æƒæ -->
<div id="scanPage" class="hidden">
  <div id="scanner"></div>
  <button class="manual-btn" onclick="openManual()">âœï¸ æ‰‹å‹•è¼¸å…¥</button>
  <button class="back-btn" onclick="backToEvent()">â¬… è¿”å›</button>
</div>

<!-- æ‰‹å‹•è¼¸å…¥ -->
<div id="manualPage" class="hidden">
  <input id="teamNo" placeholder="éšŠè™Ÿï¼ˆ01-27ï¼‰" maxlength="2">
  <input id="memberNo" placeholder="éšŠå“¡ï¼ˆA-Iï¼‰" maxlength="1">
  <button class="event-btn" onclick="submitManual()">æäº¤</button>
  <button class="back-btn" onclick="backToScan()">â¬… è¿”å›ç›¸æ©Ÿ</button>
</div>

<!-- ç¢ºèª -->
<div id="confirmPage" class="hidden">
  <div class="confirm">âœ… å·²æäº¤</div>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
// ===== Google Form =====
const FORM_URL="https://docs.google.com/forms/d/e/1FAIpQLSfb9TdBGH6aGtpX1chUArd-61hNR2QSOjyZ55_MJkReu4BZCQ/formResponse";
const ENTRY_MEMBER="entry.440560781";
const ENTRY_EVENT="entry.722246826";
const ENTRY_STAFF="entry.1290533017";
const ENTRY_DEVICE="entry.389796138";
// =======================

let staff="",eventName="",qr;
let device="DEV-"+Math.random().toString(36).substr(2,6).toUpperCase();

function show(id){
 document.querySelectorAll("div").forEach(d=>d.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

function saveStaff(){
 staff=staffInput.value.trim();
 if(!staff)return alert("è«‹è¼¸å…¥åç¨±");
 header.innerText="ğŸ“‹ é¸æ“‡é …ç›®";
 show("eventPage");
}

function selectEvent(e){
 eventName=e;
 header.innerText="ğŸ“· æƒæ QR";
 show("scanPage");
 qr=new Html5Qrcode("scanner");
 qr.start({facingMode:"environment"},{fps:10,qrbox:250},id=>submit(id));
}

function submit(id){
 const d=new FormData();
 d.append(ENTRY_MEMBER,id);
 d.append(ENTRY_EVENT,eventName);
 d.append(ENTRY_STAFF,staff);
 d.append(ENTRY_DEVICE,device);
 fetch(FORM_URL,{method:"POST",mode:"no-cors",body:d});
}

function openManual(){
 qr.stop();
 show("manualPage");
}

function submitManual(){
 let team=teamNo.value.padStart(2,"0");
 let mem=memberNo.value.toUpperCase();
 if(team<"01"||team>"27")return alert("éšŠè™ŸéŒ¯èª¤");
 if(!/[A-I]/.test(mem))return alert("éšŠå“¡éŒ¯èª¤");
 submit(team+mem);
 show("confirmPage");
 setTimeout(()=>show("manualPage"),500);
}

function backToScan(){
 show("scanPage");
}

function backToEvent(){
 show("eventPage");
}
</script>
</body>
</html>