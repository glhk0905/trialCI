<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¯”è³½ç°½åˆ°ç³»çµ±</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#000;
  color:#fff;
  margin:0;
  text-align:center;
}
header{
  background:#111;
  padding:18px;
  font-size:26px;
  font-weight:bold;
}
input,button{
  width:92%;
  max-width:420px;
  padding:18px;
  margin:12px auto;
  font-size:24px;
  border-radius:12px;
  border:none;
}
.first-btn{background:#43A047;color:#fff}
.event-btn{background:#1E88E5;color:#fff}
.manual-btn{background:#F9A825;color:#000}
.back-btn{background:#555;color:#fff}
.confirm{
  font-size:36px;
  color:#4CAF50;
  margin-top:80px;
}
.hidden{display:none}
#scanner{width:100%;max-width:420px;margin:auto}
</style>
</head>

<body>

<header id="header">ğŸ” å·¥ä½œäººå“¡ç™»å…¥</header>

<!-- âœ… å·¥ä½œäººå“¡ -->
<div id="staffPage" class="page">
  <input id="staffInput" placeholder="è¼¸å…¥å·¥ä½œäººå“¡åç¨±">
  <button class="event-btn" onclick="saveStaff()">é–‹å§‹</button>
</div>

<!-- âœ… é …ç›® -->
<div id="eventPage" class="page hidden">
  <button class="first-btn" onclick="selectEvent('é¦–æ¬¡å ±åˆ°')">â‘  é¦–æ¬¡å ±åˆ°</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®ä¸€')">â‘¡ é …ç›®ä¸€</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®äºŒ')">â‘¢ é …ç›®äºŒ</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®ä¸‰')">â‘£ é …ç›®ä¸‰</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®å››')">â‘¤ é …ç›®å››</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®äº”')">â‘¥ é …ç›®äº”</button>
  <button class="event-btn" onclick="selectEvent('é …ç›®å…­')">â‘¦ é …ç›®å…­</button>
</div>

<!-- âœ… æƒæ -->
<div id="scanPage" class="page hidden">
  <div id="scanner"></div>
  <button class="manual-btn" onclick="openManual()">âœï¸ æ‰‹å‹•è¼¸å…¥</button>
  <button class="back-btn" onclick="backToEvent()">â¬… è¿”å›</button>
</div>

<!-- âœ… æ‰‹å‹•è¼¸å…¥ -->
<div id="manualPage" class="page hidden">
  <input id="teamNo" placeholder="éšŠè™Ÿï¼ˆ01â€“27ï¼‰" maxlength="2">
  <input id="memberNo" placeholder="éšŠå“¡ï¼ˆAâ€“Iï¼‰" maxlength="1">
  <button class="event-btn" onclick="submitManual()">æäº¤</button>
  <button class="back-btn" onclick="backToScan()">â¬… è¿”å›ç›¸æ©Ÿ</button>
</div>

<!-- âœ… ç¢ºèª -->
<div id="confirmPage" class="page hidden">
  <div class="confirm">âœ… å·²æäº¤</div>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
// ===== Google Form è¨­å®š =====
const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfb9TdBGH6aGtpX1chUArd-61hNR2QSOjyZ55_MJkReu4BZCQ/formResponse";
const ENTRY_MEMBER = "entry.440560781";
const ENTRY_EVENT  = "entry.722246826";
const ENTRY_STAFF  = "entry.1290533017";
const ENTRY_DEVICE = "entry.389796138";
// ============================

let staff="", eventName="", qr=null;
let device = "DEV-" + Math.random().toString(36).substr(2,6).toUpperCase();

function show(id){
 document.querySelectorAll(".page")
   .forEach(p=>p.classList.add("hidden"));
 document.getElementById(id)
   .classList.remove("hidden");
}

// âœ… éœ‡å‹•ï¼ˆå®‰å…¨ï¼‰
function vibrate(){
 if(navigator.vibrate){
   navigator.vibrate(100);
 }
}

function saveStaff(){
 staff = staffInput.value.trim();
 if(!staff) return alert("è«‹è¼¸å…¥åç¨±");
 header.innerText="ğŸ“‹ é¸æ“‡é …ç›®";
 show("eventPage");
}

function selectEvent(e){
 eventName = e;
 header.innerText="ğŸ“· æƒæ QR";
 show("scanPage");

 setTimeout(()=>{
   qr = new Html5Qrcode("scanner");
   qr.start(
     {facingMode:"environment"},
     {fps:10, qrbox:250},
     id => {
       submit(id);
       vibrate();
     }
   );
 },200);
}

function submit(memberId){
 const d = new FormData();
 d.append(ENTRY_MEMBER, memberId);
 d.append(ENTRY_EVENT, eventName);
 d.append(ENTRY_STAFF, staff);
 d.append(ENTRY_DEVICE, device);
 fetch(FORM_URL,{method:"POST",mode:"no-cors",body:d});
}

function openManual(){
 if(qr){ qr.stop(); }
 header.innerText="âœï¸ æ‰‹å‹•è¼¸å…¥";
 show("manualPage");
}

function submitManual(){
 let team = teamNo.value.padStart(2,"0");
 let mem  = memberNo.value.toUpperCase();

 if(team < "01" || team > "27") return alert("éšŠè™Ÿå¿…é ˆ 01â€“27");
 if(!/^[A-I]$/.test(mem)) return alert("éšŠå“¡å¿…é ˆ Aâ€“I");

 submit(team + mem);
 vibrate();

 show("confirmPage");
 setTimeout(()=>show("manualPage"),500);
}

function backToScan(){
 header.innerText="ğŸ“· æƒæ QR";
 show("scanPage");
}

function backToEvent(){
 if(qr){ qr.stop(); }
 header.innerText="ğŸ“‹ é¸æ“‡é …ç›®";
 show("eventPage");
}
</script>

</body>
</html>